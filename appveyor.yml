---
version: 1.0.0-{build}

skip_tags: true

skip_commits:
  files:

    # Git
    - '.gitignore'
    - '.gitmodules'
    - '.github/**/*'

    # Docs
    - '*.md'

    # Vagrant
    - 'Vagrantfile'

    # Ansible Misc
    - 'defaults/**/*'
    - 'roles/*/files/**/*'
    - 'filter_plugins/**/*'
    - 'inventories/**/*'
    - 'library/**/*'

    # Ansible Roles - Core
    - 'roles/settings/**/*'
    - 'roles/backup/**/*'
    - 'roles/restore/**/*'

    # Ansible Roles - Extras
    - 'roles/cloudflare/**/*'
    - 'roles/ddclient/**/*'
    - 'roles/feeder/**/*'
    - 'roles/mariadb/**/*'
    - 'roles/nginx/**/*'
    - 'roles/notify/**/*'
    - 'roles/nvidia/**/*'
    - 'roles/nzbthrottle/**/*'
    - 'roles/plex_auth_token/**/*'
    - 'roles/plex_dupefinder/**/*'
    - 'roles/plex_patrol/**/*'
    - 'roles/python-plexlibrary/**/*'
    - 'roles/sickbeard_mp4_automator/**/*'
    - 'roles/sstvirl/**/*'
    - 'roles/subliminal/**/*'
    - 'roles/trackarr/**/*'
    - 'roles/traktarr/**/*'

  message: /\[minor\]/

image: Ubuntu1804-minimal

matrix:
  fast_finish: true

# to disable automatic builds
build: off

init:
  - sh: curl -s https://raw.githubusercontent.com/Cloudbox/cb/develop/cb_dep.sh | sudo -H bash

install:
  - sh: for i in defaults/*; do cp -n $i "$(basename "${i%.*}")"; done
  - sh: sudo ansible-playbook cloudbox.yml --syntax-check
  - sh: sudo ansible-playbook cloudbox.yml --tags core --skip-tags "settings" --extra-vars '{"continuous_integration":true}'
  - sh: sudo docker login -u $DOCKER_USER -p $DOCKER_PWD
  - sh: |
      sudo ansible-playbook cloudbox.yml --tags "cloudbox,emby,netdata,sabnzbd" \
          --skip-tags "settings" \
          --extra-vars '{"continuous_integration":true}'
